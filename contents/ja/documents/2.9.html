<h1>Ebitengine 2.9 リリースノート</h1>
<h2>v2.9.0</h2>
<p><a href="https://github.com/hajimehoshi/ebiten/milestone/124?closed=1">Issues for v2.9.0</a></p>
<p>このリリースでは、主に細かい機能追加、バグ修正、パフォーマンス改善を行いました。</p>
<p>Ebitengine 2.9 から Go 1.24 以上が必要になりました。</p>
<h3>ベクターグラフィックスの描画クオリティ向上</h3>
<p>Issues: <a href="https://github.com/hajimehoshi/ebiten/issues/3124">#3124</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3278">#3278</a></p>
<p>これまでの <code>vector</code> パッケージは <code>AppendVerticesAndIndicesForFilling</code> 関数や <code>AppendVerticesAndIndicesForStroke</code> 関数を用いて、ベクター図形を三角形の図形に分割してそれを三角形として描画していました。これには次のような問題がありました:</p>
<ul>
  <li>エッジ部分がきれいにならない。 Ebitengine では一旦大きいオフスクリーンにベクターグラフィックを描画してそれを縮めるという手法を採用しているが、実行効率も質もあまり良くなかった。</li>
  <li>半透明色の描画が不可能だった。</li>
  <li><code>Blend</code> オプションが期待通りに動作しなかった。</li>
</ul>
<p>新しい手法では、特殊なシェーダーを用いて独自のステンシルバッファーを作成し、そのステンシルバッファーを使って色を塗りつぶすようにしました。これにより、同程度かそれ未満のテクスチャ使用量でも 1 ピクセルあたりのサンプル数が増え、描画結果の質が向上しました。また、複数の三角形を重ねて描画するのではなく、完成されたステンシルバッファーを一気に塗りつぶすため、半透明色を使った描画や <code>Blend</code> オプションの指定が正しく動作するようになりました。実装にあたっては Evan Wallace さんのブログ記事「<a href="https://medium.com/@evanwallace/easy-scalable-text-rendering-on-the-gpu-c3f4d782c5ac">Easy Scalable Text Rendering on the GPU</a>」を参考にさせていただきました。</p>
<p>新描画手法のために追加された関数は主に <a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a> と <a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#StrokePath"><code>vector.StrokePath()</code></a> になります。新描画手法を使用するためには、これまでの <code>AppendVerticesAndIndicesFor</code>… 関数呼出しを、新しい関数呼び出しに置き換える必要があります。これまでの <code>AppendVerticesAndIndicesFor</code>… 関数に関しては描画の結果は変わりません。また、これらの関数は非推奨になります。非推奨関数は、 Ebitengine のメジャーバージョンが同じである限り、これまで通り動きます。ただし、新しいメジャーバージョンでは削除される可能性があります。</p>
<figure>
  <p class="img"><img src="/images/documents/2.9/vector.png" width="744" ></p>
  <figcaption>ベクターグラフィックス描画の新旧手法比較</figcaption>
</figure>
<h3>新しい API</h3>
<ul>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2#DefaultDrawFinalScreen"><code>ebiten.DefaultDrawFinalScreen</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3139">#3139</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2#FilterPixelated"><code>ebiten.FilterPixelated</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/2826">#2826</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2#Tick"><code>ebiten.Tick()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3213">#3213</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2#Image.DrawTriangles32"><code>(*ebiten.Image).DrawTriangles32</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3201">#3201</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2#Image.DrawTrianglesShader32"><code>(*ebiten.Image).DrawTrianglesShader32</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3201">#3201</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2#RunGameOptions.ApplePressAndHoldEnabled"><code>ebiten.RunGameOptions.ApplePressAndHoldEnabled</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3233">#3233</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/audio#ResampleReader"><code>audio.ResampleReader</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3194">#3194</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/audio#ResampleReaderF32"><code>audio.ResampleReaderF32</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3194">#3194</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/colorm#DrawImageOptions.ColorScale"><code>colorm.DrawImageOptions.ColorScale</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3188">#3188</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#DrawPathOptions"><code>vector.DrawPathOptions</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3287">#3287</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillOptions"><code>vector.FillOptions</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3287">#3287</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillRule"><code>vector.FillRule</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillRuleNonZero"><code>vector.FillRuleNonZero</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillRuleEvenOdd"><code>vector.FillRuleEvenOdd</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillCircle"><code>vector.FillCircle()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3278">#3278</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillRect"><code>vector.FillRect()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#StrokePath"><code>vector.StrokePath()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3278">#3278</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#Path.AddPath"><code>(*vector.Path).AddPath()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3266">#3266</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#Path.AddStroke"><code>(*vector.Path).AddStroke()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3266">#3266</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#Path.Bounds"><code>(*vector.Path).Bounds()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3271">#3271</a>)</li>
  <li><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#Path.Reset"><code>(*vector.Path).Reset()</code></a> (<a href="https://github.com/hajimehoshi/ebiten/issues/3123">#3123</a>)</li>
</ul>
<h3>非推奨になった API</h3>
<table>
  <tr>
    <th>2.8 以前</th>
    <th>2.9 以降</th>
    <th>Issue</th>
  </tr>
  <tr>
    <td><code>ebiten.FillRule</code></td>
    <td></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>ebiten.DrawTrianglesOptions.AntiAlias</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>ebiten.DrawTrianglesOptions.FillRule</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>ebiten.DrawTrianglesShaderOptions.AntiAlias</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>ebiten.DrawTrianglesShaderOptions.FillRule</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>audio.Resample()</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/audio#ResampleReader"><code>audio.ResampleReader()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3194">#3194</a></td>
  </tr>
  <tr>
    <td><code>audio.ResampleF32()</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/audio#ResampleReaderF32"><code>audio.ResampleReaderF32()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3194">#3194</a></td>
  </tr>
  <tr>
    <td><code>colorm.DrawTrianglesOptions.AntiAlias</code></td>
    <td></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>colorm.DrawTrianglesOptions.FillRule</code></td>
    <td></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>text/v2.GoTextFace.Script</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/text/v2#GoTextFace.Language"><code>text/v2.GoTextFace.Language</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3175">#3175</a></td>
  </tr>
  <tr>
    <td><code>vector.Path.AppendVerticesAndIndicesForFilling()</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>vector.Path.AppendVerticesAndIndicesForStroke()</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillPath"><code>vector.FillPath()</code></a> と <a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#Path.AddStroke"><code>vector.Path.AddStroke()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3153">#3153</a></td>
  </tr>
  <tr>
    <td><code>vector.DrawFilledCircle()</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillCircle"><code>vector.FillCircle()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a></td>
  </tr>
  <tr>
    <td><code>vector.DrawFilledRect()</code></td>
    <td><a href="https://pkg.go.dev/github.com/hajimehoshi/ebiten/v2/vector#FillRect"><code>vector.FillRect()</code></a></td>
    <td><a href="https://github.com/hajimehoshi/ebiten/issues/3150">#3150</a></td>
  </tr>
</table>
<h3>バグ修正</h3>
<p>このリリースは、以下の修正に加えて、バージョン 2.8 にあった全てのバグ修正を含みます。</p>
<ul>
  <li>ウィンドウのモニター間の移動でクラッシュが起きることがあった問題の修正 (<a href=https://github.com/hajimehoshi/ebiten/issues/3121">#3121</a>)。</li>
  <li>タッチパッドの入力で <code>ebiten.IsMouseButtonPressed</code> や <code>inpututil.IsMouseButtonJustPressed</code> の結果が正しくないことがあった問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3137">#3137</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3249">#3249</a>)。</li>
  <li>ウィンドウがバックグラウンドのときに、 <code>(*audio.Player).Position()</code> が正しい値を返さなかった問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3154">#3154</a>)。</li>
  <li>シェーディング言語 Kage で、ユニフォーム変数に bool 型を指定するとクラッシュした問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3165">#3165</a>)。</li>
  <li><code>audio/vorbis</code> パッケージなどで、 <code>io.Seeker</code> を正しく実装していないソースをデコーダなどに与えたときにクラッシュした問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3192">#3192</a>、 <a href="https://github.com/hajimehoshi/ebiten/issues/3193">#3193</a>)。</li>
  <li><code>ebiten.SetWindowMousePassThrough</code> を起動前に呼んでも正しく動作しなかった問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3222">#3222</a>)。</li>
  <li>macOS で画面に時々ちらつきが発生していた問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3278">#3278</a>)。</li>
  <li>スリープ復帰時に音楽が勝手に再生してしまうことがあった問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3297">#3297</a>)。</li>
  <li>その他マイナーな問題の修正</li>
</ul>
<h3>パフォーマンス改善</h3>
<ul>
  <li><code>(*ebiten.Image).SubImage()</code> の結果が内部で一定時間キャッシュされるように修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/2902">#2902</a>)。</li>
  <li>その他マイナーなパフォーマンス改善</li>
</ul>
<h2>v2.9.1</h2>
<p><a href="https://github.com/hajimehoshi/ebiten/milestone/146?closed=1">Issues for v2.9.1</a></p>
<h3>バグ修正</h3>
<ul>
  <li>1 回キーを離しただけなのに、 <code>inpututil.IsKeyJustReleased</code> が連続したティック (Update) で true を返すことがあった問題の修正 (<a href="https://github.com/hajimehoshi/ebiten/issues/3326">#3326</a>)。</li>
</ul>
